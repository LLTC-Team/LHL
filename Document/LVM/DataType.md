# LVM虚拟机内部数据类型

- [LVM虚拟机内部数据类型](#lvm%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%86%85%E9%83%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B)
    - [整数类型](#%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B)
    - [浮点类型](#%E6%B5%AE%E7%82%B9%E7%B1%BB%E5%9E%8B)
    - [引用类型](#%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B)

本文档将会描述LVM虚拟机内部使用的所有数据类型。请注意，LVM虚拟机内部的数据类型和在其之上运行的高级语言的数据类型并不相同，请不要将它们混淆。

LVM在任何时候，任何操作系统下，都将使用 **大端序** 进行数据存取。LVM对所有内存空间都将进行4位字节对齐处理，以简化内部处理和提升性能。

LVM内部有三类数据类型，分别为：整数类型，浮点类型，引用类型。

以下描述的数据类型都不一定在其上层语言中有对应的数据类型，但是LVM对其提供了相应的支持以满足可能出现的需求。

关于以下数据类型的具体操作，将在LVM字节码指令集中详细描述。

## 整数类型

LVM支持两种整数：

| 类型   | 描述                     | 数据范围                                                                  |
| ------ | ------------------------ | ------------------------------------------------------------------------- |
| `int`  | 32位有符号二进制补码整数 | [-2,147,483,648, 2,147,483,647] ([-2^31, 2^31-1])                         |
| `long` | 64位有符号二进制补码整数 | [-9,223,372,036,854,775,808, 9,223,372,036,854,775,807] ([-2^63, 2^63-1]) |

这两种是最基础的数据类型，用它们可以实现其他高层语言中可能有的整数类型，在LVM中就只提供了这两种数据类型的支持。

开发人员资料：

- [二进制补码](https://zh.wikipedia.org/wiki/%E4%BA%8C%E8%A3%9C%E6%95%B8)

## 浮点类型

LVM包括两种浮点类型：

| 类型     | 描述             |
| -------- | ---------------- |
| `float`  | 32位单精度浮点数 |
| `double` | 64位双精度浮点数 |

LVM浮点数的实现需要遵守IEEE 754标准的所有规定，包括存储方式、基本运算和异常情况等。

开发人员资料：

- [维基百科上的IEEE 754描述](https://zh.wikipedia.org/wiki/IEEE_754)
- [IEEE 754标准参考文献](https://web.archive.org/web/20070505021348/http://babbage.cs.qc.edu/courses/cs341/IEEE-754references.html)
- [IEEE 754标准中的详尽的数学原理与某些实现方式](https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html)

## 引用类型

引用类型（`reference`）表示 **堆内存地址**。`reference`类型仅存在于LVM内部，不应在上层语言中出现直接的数据类型映射。`reference`类型与上层语言中可能出现的指针或引用类型没有任何直接联系。

`reference`将会被实现为一个64位无符号整数，用以支持足够大的堆内存空间的检索。

`null`为reference类型的默认值，在内部以无符号数`0`表示，代表此引用不指向任何实际的内存空间。

LVM对数组的访问，结构体的访问，常量的访问等都将使用`reference`实现，具体操作将会在LVM字节码指令集中描述。